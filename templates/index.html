<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>‚òÅÔ∏è –û–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ</h1>
        
        <div class="welcome">
            <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
            <p>–ó–∞–≥—Ä—É–∂–∞–π—Ç–µ –∏ —É–ø—Ä–∞–≤–ª—è–π—Ç–µ –≤–∞—à–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏ –≤ –æ–±–ª–∞–∫–µ. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç—ã: 
               txt, pdf, png, jpg, jpeg, gif, doc, docx, xls, xlsx, zip</p>
            <p><small>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: 16MB</small></p>
        </div>
        
        <div id="alert" class="alert"></div>
        
        <div class="upload-section">
            <h3>üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª</h3>
            <form id="uploadForm" class="upload-form">
                <input type="file" name="file" id="fileInput" class="file-input" required>
                <button type="submit" class="btn" id="uploadBtn">
                    <span>–ó–∞–≥—Ä—É–∑–∏—Ç—å</span>
                </button>
            </form>
        </div>
        
        <div class="files-section">
            <div class="files-header">
                <h3>üìÅ –í–∞—à–∏ —Ñ–∞–π–ª—ã</h3>
                <span class="file-count">{{ files|length }} —Ñ–∞–π–ª–æ–≤</span>
            </div>
            
            {% if files %}
            <ul class="file-list" id="fileList">
                {% for file in files %}
                <li class="file-item" data-filename="{{ file.unique_name }}">
                    <div class="file-info">
                        <div class="file-name">{{ file.original_name }}</div>
                        <div class="file-meta">
                            <span class="file-size">üì¶ {{ file.size_human }}</span>
                            <span class="file-date">üìÖ {{ file.upload_date[:10] }}</span>
                            <span class="file-path">üìç {{ file.subdir }}</span>
                        </div>
                    </div>
                    <div class="file-actions">
                        <a href="/files/{{ file.unique_name }}" class="download-btn" download>–°–∫–∞—á–∞—Ç—å</a>
                        <button onclick="deleteFile('{{ file.unique_name }}')" class="delete-btn">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </li>
                {% endfor %}
            </ul>
            {% else %}
            <div class="empty-state">
                <p>üì≠ –ù–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤</p>
                <p style="font-size: 14px; margin-top: 10px;">–ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø–µ—Ä–≤—ã–π —Ñ–∞–π–ª!</p>
            </div>
            {% endif %}
        </div>
    </div>
    
    <script>
        const uploadForm = document.getElementById('uploadForm');
        const fileInput = document.getElementById('fileInput');
        const alertDiv = document.getElementById('alert');
        
        function showAlert(message, type = 'success') {
            alertDiv.textContent = message;
            alertDiv.className = `alert alert-${type}`;
            
            setTimeout(() => {
                alertDiv.style.display = 'none';
            }, 5000);
        }
        
        async function deleteFile(filename) {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ñ–∞–π–ª?')) {
                return;
            }
            
            try {
                const response = await fetch(`/delete/${filename}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showAlert('–§–∞–π–ª —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω!', 'success');
                    // —É–¥–∞–ª—è–µ—Ç —ç–ª–µ–º–µ–Ω—Ç –∏–∑ —Å–ø–∏—Å–∫–∞
                    const fileItem = document.querySelector(`[data-filename="${filename}"]`);
                    if (fileItem) {
                        fileItem.remove();
                    }
                    // –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—á–µ—Ç—á–∏–∫
                    updateFileCount();
                } else {
                    showAlert(result.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞', 'error');
                }
            } catch (error) {
                showAlert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
            }
        }
        
        function updateFileCount() {
            const fileCount = document.querySelectorAll('.file-item').length;
            const countElement = document.querySelector('.file-count');
            if (countElement) {
                countElement.textContent = `${fileCount} —Ñ–∞–π–ª–æ–≤`;
            }
        }
        
        uploadForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const file = fileInput.files[0];
            if (!file) {
                showAlert('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏', 'error');
                return;
            }
            
            const formData = new FormData();
            formData.append('file', file);
            
            const uploadBtn = document.getElementById('uploadBtn');
            const originalText = uploadBtn.innerHTML;
            uploadBtn.innerHTML = '<span class="loading"></span> –ó–∞–≥—Ä—É–∑–∫–∞...';
            uploadBtn.disabled = true;
            
            try {
                const response = await fetch('/upload', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showAlert('–§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω!', 'success');
                    fileInput.value = '';
                    setTimeout(() => {
                        location.reload();
                    }, 1000);
                } else {
                    showAlert(result.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞', 'error');
                }
            } catch (error) {
                showAlert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
            } finally {
                uploadBtn.innerHTML = originalText;
                uploadBtn.disabled = false;
            }
        });
    </script>
</body>
</html>